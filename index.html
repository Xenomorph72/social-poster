<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FILM426 Social Poster Pro</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <style>
    :root {
      --bg-deep: #0a0a0f;
      --bg-card: #14141f;
      --bg-input: #1a1a2e;
      --bg-hover: #1f1f2e;
      --border-subtle: #2a2a3e;
      --border-active: #3a3a4e;
      --accent-cyan: #00d4ff;
      --accent-orange: #ff6b35;
      --accent-green: #00c853;
      --text-primary: #ffffff;
      --text-secondary: #a0a0b0;
      --text-muted: #606070;
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-deep);
      color: var(--text-secondary);
      min-height: 100vh;
      padding: 20px;
      line-height: 1.6;
    }
    
    .container { max-width: 1400px; margin: 0 auto; }
    
    header {
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border-subtle);
    }
    
    h1 {
      color: var(--text-primary);
      font-size: 1.75rem;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .subtitle {
      color: var(--text-muted);
      font-size: 0.9375rem;
    }
    
    /* Campaign Section */
    .section {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 24px;
    }
    
    .section-title {
      color: var(--text-primary);
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    /* Campaign List */
    .campaign-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .campaign-item {
      background: var(--bg-input);
      border: 1px solid var(--border-subtle);
      border-radius: 10px;
      padding: 16px 20px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .campaign-item:hover {
      border-color: var(--accent-cyan);
      transform: translateX(4px);
    }
    
    .campaign-item.active {
      border-color: var(--accent-cyan);
      background: rgba(0, 212, 255, 0.05);
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.1);
    }
    
    .campaign-item.empty {
      opacity: 0.4;
      cursor: default;
    }
    
    .campaign-item.empty:hover {
      border-color: var(--border-subtle);
      transform: none;
    }
    
    .campaign-name {
      color: var(--text-primary);
      font-size: 1rem;
      font-weight: 500;
      margin-bottom: 4px;
    }
    
    .campaign-meta {
      font-size: 0.8125rem;
      color: var(--text-muted);
    }
    
    .campaign-badge {
      font-size: 0.75rem;
      padding: 4px 12px;
      border-radius: 20px;
      font-weight: 600;
    }
    
    .campaign-badge.ready {
      background: rgba(0, 200, 83, 0.15);
      color: var(--accent-green);
    }
    
    .campaign-badge.loaded {
      background: rgba(0, 212, 255, 0.15);
      color: var(--accent-cyan);
    }
    
    /* Week Grid */
    .week-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 12px;
    }
    
    .day-card {
      background: var(--bg-input);
      border: 1px solid var(--border-subtle);
      border-radius: 10px;
      padding: 16px;
      min-height: 140px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .day-card:hover:not(.empty) {
      border-color: var(--accent-cyan);
      transform: translateY(-2px);
    }
    
    .day-card.active {
      border-color: var(--accent-cyan);
      background: rgba(0, 212, 255, 0.05);
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.15);
    }
    
    .day-card.used {
      opacity: 0.5;
    }
    
    .day-card.empty {
      opacity: 0.3;
      cursor: not-allowed;
    }
    
    .day-name {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .day-number {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-primary);
      margin: 4px 0;
    }
    
    .post-type-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.6875rem;
      font-weight: 600;
      text-transform: uppercase;
      margin-top: 8px;
    }
    
    .post-type-badge.teaser { background: rgba(255, 171, 0, 0.15); color: #ffab00; }
    .post-type-badge.announce { background: rgba(255, 107, 53, 0.15); color: var(--accent-orange); }
    .post-type-badge.release { background: rgba(0, 200, 83, 0.15); color: var(--accent-green); }
    .post-type-badge.behind { background: rgba(137, 87, 229, 0.15); color: #8957e5; }
    .post-type-badge.followup { background: rgba(0, 212, 255, 0.15); color: var(--accent-cyan); }
    .post-type-badge.reminder { background: rgba(160, 160, 176, 0.15); color: var(--text-secondary); }
    .post-type-badge.poll { background: rgba(163, 113, 247, 0.15); color: #a371f7; }
    
    .day-status {
      font-size: 0.6875rem;
      color: var(--accent-cyan);
      margin-top: 8px;
      font-weight: 500;
    }
    
    /* Editor */
    .editor {
      display: none;
    }
    
    .editor.active { display: block; }
    
    .editor-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border-subtle);
    }
    
    .editor-title {
      color: var(--text-primary);
      font-size: 1.125rem;
      font-weight: 600;
    }
    
    .close-btn {
      padding: 8px 16px;
      background: transparent;
      border: 1px solid var(--border-subtle);
      border-radius: 6px;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 0.875rem;
      transition: all 0.2s ease;
    }
    
    .close-btn:hover {
      border-color: var(--accent-orange);
      color: var(--accent-orange);
    }
    
    /* Post Boxes */
    .posts-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }
    
    .post-box {
      background: var(--bg-input);
      border: 1px solid var(--border-subtle);
      border-radius: 10px;
      padding: 16px;
    }
    
    .post-box h3 {
      color: var(--accent-cyan);
      font-size: 0.875rem;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .post-box textarea {
      width: 100%;
      height: 200px;
      padding: 12px;
      background: var(--bg-deep);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      color: var(--text-primary);
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8125rem;
      line-height: 1.6;
      resize: vertical;
      transition: all 0.2s ease;
    }
    
    #patreon-post {
      height: 350px;
    }
    
    #image-prompt {
      height: 200px;
    }
    
    .post-box textarea:focus {
      outline: none;
      border-color: var(--accent-cyan);
    }
    
    .char-count {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 8px;
      text-align: right;
    }
    
    /* Actions */
    .actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--border-subtle);
    }
    
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .btn-copy {
      background: transparent;
      border: 1px solid var(--border-subtle);
      color: var(--text-secondary);
    }
    
    .btn-copy:hover {
      border-color: var(--accent-cyan);
      color: var(--accent-cyan);
    }
    
    .btn-archive {
      background: var(--accent-orange);
      color: white;
    }
    
    .btn-archive:hover {
      transform: translateY(-1px);
      box-shadow: 0 0 20px rgba(255, 107, 53, 0.3);
    }
    
    /* Archive */
    .archive-list {
      max-height: 300px;
      overflow-y: auto;
    }
    
    .archive-item {
      background: var(--bg-input);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      padding: 14px 16px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .archive-meta {
      font-size: 0.75rem;
      color: var(--text-muted);
    }
    
    .archive-title {
      color: var(--text-primary);
      font-weight: 500;
      font-size: 0.9375rem;
    }
    
    /* Toast */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 14px 24px;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-left: 3px solid var(--accent-green);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 0.9375rem;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.3s ease;
      z-index: 1000;
    }
    
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    /* Responsive */
    @media (max-width: 1024px) {
      .week-grid { grid-template-columns: repeat(4, 1fr); }
      .posts-grid { grid-template-columns: 1fr; }
    }
    
    @media (max-width: 768px) {
      .week-grid { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div style="display:flex;align-items:center;gap:12px;">
        <div>
          <h1>üéµ FILM426 Social Poster Pro</h1>
          <p class="subtitle">Campaign Manager</p>
        </div>
        <button id="syncBtn" style="margin-left:auto;padding:8px 16px;background:#6366f1;color:white;border:none;border-radius:6px;cursor:pointer;">üîÑ Sync</button>
        <button id="clearBtn" style="margin-left:8px;padding:8px 16px;background:#ef4444;color:white;border:none;border-radius:6px;cursor:pointer;">üóëÔ∏è Clear</button>
      </div>
    </header>
    
    <!-- Campaign Selection -->
    <div class="section">
      <h2 class="section-title">üìã Available Campaigns</h2>
      <div class="campaign-list" id="campaign-list">
        <p style="color: var(--text-muted);">Loading...</p>
      </div>
    </div>
    
    <!-- Week Grid -->
    <div class="section" id="week-section" style="display: none;">
      <h2 class="section-title" id="week-title">Campaign Posts</h2>
      <div class="week-grid" id="week-grid"></div>
    </div>
    
    <!-- Post Editor -->
    <div class="section editor" id="editor">
      <div class="editor-header">
        <h2 class="editor-title" id="editor-title">Select a day</h2>
        <button class="close-btn" onclick="closeEditor()">Close</button>
      </div>
      
      <div class="posts-grid">
        <div class="post-box">
          <h3>üê¶ X / Threads</h3>
          <textarea id="x-post" placeholder="X/Threads post..."></textarea>
          <div class="char-count" id="x-count">0 / 280</div>
        </div>
        
        <div class="post-box">
          <h3>üì∏ Instagram / Facebook</h3>
          <textarea id="ig-post" placeholder="Instagram/Facebook post..."></textarea>
        </div>
        
        <div class="post-box">
          <h3>üé¨ TikTok / YouTube Shorts</h3>
          <textarea id="video-post" placeholder="TikTok/YouTube script..."></textarea>
        </div>
        
        <div class="post-box">
          <h3>‚ù§Ô∏è Patreon</h3>
          <textarea id="patreon-post" placeholder="Patreon post (long-form)..."></textarea>
        </div>
        
        <div class="post-box">
          <h3>üñºÔ∏è Image Prompts</h3>
          <textarea id="image-prompt" placeholder="Image generation prompts for this campaign..."></textarea>
        </div>
      </div>
      
      <div class="actions">
        <button class="btn btn-copy" onclick="copyAll()">üìã Copy All</button>
        <button class="btn btn-archive" onclick="archiveDay()">üìÅ Archive & Clear</button>
      </div>
    </div>
    
    <!-- Archive -->
    <div class="section">
      <h2 class="section-title">üìÅ Archived Posts</h2>
      <div class="archive-list" id="archive-list">
        <p style="color: var(--text-muted);">No archived posts yet.</p>
      </div>
    </div>
  </div>
  
  <div class="toast" id="toast"></div>
  
  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCPwmu7TwiF4j2DatPa1TjK8QF4YSHE",
      authDomain: "dash-clawd.firebaseapp.com",
      projectId: "dash-clawd",
      storageBucket: "dash-clawd.appspot.com",
      messagingSenderId: "123456789",
      appId: "1:123456789:web:xxxxxxxxxxxxxxxx"
    };
    
    let db;
    let campaigns = [];
    let currentCampaign = null;
    let currentDay = null;
    let weekData = {};
    let archive = JSON.parse(localStorage.getItem('socialArchive') || '[]');
    
    const typeLabels = {
      teaser: 'Teaser',
      behind: 'Behind',
      announce: 'Announce',
      release: 'Release',
      followup: 'Follow-up',
      reminder: 'Reminder',
      poll: 'Poll'
    };
    
    // Initialize
    async function init() {
      try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        await loadCampaigns();
      } catch(e) {
        console.log('Firebase error, using local:', e);
        loadLocalCampaigns();
      }
      renderArchive();
    }
    
    // Load campaigns
    async function loadCampaigns() {
      try {
        const snapshot = await db.collection('socialCampaigns').get();
        campaigns = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        renderCampaigns();
      } catch(e) {
        loadLocalCampaigns();
      }
    }
    
    // Version for cache-busting
    const APP_VERSION = Date.now();
    
    // Local campaigns fallback (localStorage + campaigns.json)
    async function loadLocalCampaigns(forceRefresh = false) {
      // First try localStorage
      let localCampaigns = JSON.parse(localStorage.getItem('socialCampaigns') || '[]');
      
      // Then try campaigns.json file with cache-busting
      try {
        const cacheParam = forceRefresh ? `?v=${APP_VERSION}` : '';
        const response = await fetch('campaigns.json' + cacheParam);
        if (response.ok) {
          const fileCampaigns = await response.json();
          // Merge, preferring newer ones
          const existingIds = new Set(localCampaigns.map(c => c.name));
          fileCampaigns.forEach(c => {
            if (!existingIds.has(c.name)) {
              localCampaigns.push(c);
            }
          });
        }
      } catch(e) {
        // campaigns.json not available (local development)
      }
      
      campaigns = localCampaigns;
      renderCampaigns();
    }
    
    // Render campaigns
    function renderCampaigns() {
      const list = document.getElementById('campaign-list');
      
      if (campaigns.length === 0) {
        list.innerHTML = '<p style="color: var(--text-muted);">No campaigns yet. Bella will add them.</p>';
        return;
      }
      
      list.innerHTML = campaigns.map((c, index) => `
        <div class="campaign-item ${currentCampaign === c ? 'active' : ''}" onclick="selectCampaign(${index})">
          <div>
            <div class="campaign-name">${c.name}</div>
            <div class="campaign-meta">${c.description || '7 posts'} ‚Ä¢ Created ${new Date(c.createdAt).toLocaleDateString()}</div>
          </div>
          <div class="campaign-badge ${currentCampaign === c ? 'loaded' : 'ready'}">
            ${currentCampaign === c ? '‚úì Loaded' : 'Ready'}
          </div>
        </div>
      `).join('');
    }
    
    // Select campaign
    function selectCampaign(index) {
      currentCampaign = campaigns[index];
      weekData = currentCampaign?.posts || {};
      
      document.getElementById('week-section').style.display = 'block';
      document.getElementById('week-title').textContent = currentCampaign?.name || 'Campaign Posts';
      
      renderCampaigns();
      renderWeekGrid();
      
      document.getElementById('week-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
    
    // Render week grid
    function renderWeekGrid() {
      const grid = document.getElementById('week-grid');
      grid.innerHTML = '';
      
      const today = new Date();
      
      for (let i = 0; i < 7; i++) {
        const date = new Date(today);
        date.setDate(today.getDate() + i);
        const dayKey = date.toISOString().split('T')[0];
        const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
        const dayNum = date.getDate();
        
        const dayData = weekData[dayKey] || {};
        const hasContent = dayData.x || dayData.ig;
        const isUsed = dayData.used;
        
        const card = document.createElement('div');
        card.className = `day-card ${isUsed ? 'used' : ''} ${hasContent ? '' : 'empty'}`;
        if (hasContent) {
          card.onclick = () => selectDay(dayKey, date);
        }
        
        card.innerHTML = `
          <div class="day-name">${dayName}</div>
          <div class="day-number">${dayNum}</div>
          ${dayData.type ? `<span class="post-type-badge ${dayData.type}">${typeLabels[dayData.type]}</span>` : ''}
          ${hasContent ? '<div class="day-status">‚úì Ready</div>' : ''}
        `;
        
        grid.appendChild(card);
      }
    }
    
    // Helper: Fix escaped newlines
    function fixNewlines(text) {
      if (!text) return '';
      // Convert literal \n to real newlines
      return text.replace(/\\n/g, '\n').replace(/\\n/g, '\n');
    }
    
    // Select day
    function selectDay(dayKey, dateObj) {
      currentDay = dayKey;
      const dayData = weekData[dayKey] || {};
      
      document.getElementById('editor-title').textContent = 
        `${dateObj.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' })}` +
        (dayData.type ? ` ‚Äî ${typeLabels[dayData.type]}` : '');
      
      document.getElementById('x-post').value = fixNewlines(dayData.x) || '';
      document.getElementById('ig-post').value = fixNewlines(dayData.ig) || '';
      
      // Handle new video format (object with image_description and script)
      if (typeof dayData.video === 'object' && dayData.video !== null) {
        // Prefer script, but include image_description if available
        const script = dayData.video.script || '';
        const imageDesc = dayData.video.image_description || '';
        // Combine image description and script for the textarea
        document.getElementById('video-post').value = (imageDesc ? `[IMAGE DESCRIPTION]\n${imageDesc}\n\n[SCRIPT]\n${script}` : script) || '';
      } else {
        // Fallback for old string format
        document.getElementById('video-post').value = fixNewlines(dayData.video) || '';
      }
      
      document.getElementById('patreon-post').value = fixNewlines(dayData.patreon) || '';
      document.getElementById('image-prompt').value = fixNewlines(dayData.image_prompt) || '';
      
      updateCharCount();
      document.getElementById('editor').classList.add('active');
      document.getElementById('editor').scrollIntoView({ behavior: 'smooth' });
    }
    
    // Close editor
    function closeEditor() {
      document.getElementById('editor').classList.remove('active');
      currentDay = null;
    }
    
    // Copy all
    function copyAll() {
      const x = document.getElementById('x-post').value;
      const ig = document.getElementById('ig-post').value;
      const video = document.getElementById('video-post').value;
      const patreon = document.getElementById('patreon-post').value;
      const imagePrompt = document.getElementById('image-prompt').value;
      
      const all = `=== X/THREADS ===\n${x}\n\n=== INSTAGRAM/FACEBOOK ===\n${ig}\n\n=== TIKTOK/YOUTUBE ===\n${video}\n\n=== PATREON ===\n${patreon}\n\n=== IMAGE PROMPTS ===\n${imagePrompt}`;
      
      navigator.clipboard.writeText(all).then(() => {
        showToast('Copied to clipboard!');
      });
    }
    
    // Archive day
    function archiveDay() {
      if (!currentDay) return;
      
      archive.unshift({
        ...weekData[currentDay],
        archivedAt: new Date().toISOString(),
        archivedDate: new Date().toLocaleDateString()
      });
      
      localStorage.setItem('socialArchive', JSON.stringify(archive));
      
      weekData[currentDay].used = true;
      closeEditor();
      renderWeekGrid();
      renderArchive();
      showToast('Archived!');
    }
    
    // Render archive
    function renderArchive() {
      const list = document.getElementById('archive-list');
      if (archive.length === 0) {
        list.innerHTML = '<p style="color: var(--text-muted);">No archived posts yet.</p>';
        return;
      }
      
      list.innerHTML = archive.map(item => `
        <div class="archive-item">
          <div>
            <div class="archive-meta">${item.archivedDate}</div>
            <div class="archive-title">${typeLabels[item.type] || 'Post'}</div>
          </div>
        </div>
      `).join('');
    }
    
    // Update char count
    function updateCharCount() {
      const x = document.getElementById('x-post').value;
      document.getElementById('x-count').textContent = `${x.length} / 280`;
    }
    
    document.getElementById('x-post').addEventListener('input', updateCharCount);
    document.getElementById('x-post').addEventListener('input', () => saveCurrentDay());
    document.getElementById('ig-post').addEventListener('input', () => saveCurrentDay());
    document.getElementById('video-post').addEventListener('input', () => saveCurrentDay());
    document.getElementById('patreon-post').addEventListener('input', () => saveCurrentDay());
    
    // Save current day data
    function saveCurrentDay() {
      if (!currentDay) return;
      weekData[currentDay].x = document.getElementById('x-post').value;
      weekData[currentDay].ig = document.getElementById('ig-post').value;
      weekData[currentDay].video = document.getElementById('video-post').value;
      weekData[currentDay].patreon = document.getElementById('patreon-post').value;
      weekData[currentDay].image_prompt = document.getElementById('image-prompt').value;
      localStorage.setItem('socialCampaigns', JSON.stringify(campaigns));
      localStorage.setItem('socialWeekData', JSON.stringify(weekData));
    }
    
    // Toast
    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }
    
    // Init
    init();
    
    // Sync buttons
    document.getElementById('syncBtn').addEventListener('click', function() {
      console.log('SYNC CLICKED');
      loadLocalCampaigns(true);
    });
    document.getElementById('clearBtn').addEventListener('click', function() {
      console.log('CLEAR CLICKED');
      localStorage.removeItem('socialCampaigns');
      loadLocalCampaigns(true);
    });
  </script>
</body>
</html>
